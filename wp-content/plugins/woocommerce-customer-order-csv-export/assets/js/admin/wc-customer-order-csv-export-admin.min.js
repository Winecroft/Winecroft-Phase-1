(function(){jQuery(document).ready(function(a){"use strict";var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;return p={},d=a.WCBackboneModal.View,s=function(a,b,c,d,e,f){var g,h,i;return i=a.length,e=e||25,f=f||i,h=0,g=function(){var j,k;for(k=+new Date,j=h;h<i&&h-j<f&&new Date-k<50;)b.call(c,a[h]),h+=1;return h<i?setTimeout(g,e):d(a)},setTimeout(g,25)},q=function(b){var c,d;return d={},c=function(b,c){var e;c.name=c.name.replace("[]",""),e=d[c.name],"undefined"!=typeof e&&null!==e?a.isArray(e)?e.push(c.value):d[c.name]=[e,c.value]:d[c.name]=c.value},a.each(a(b).serializeArray(),c),d},r=function(b){return a("#wc-backbone-modal-dialog .modal-close").trigger("click"),b.button_class=b.button_class||"",new d({target:"wc-customer-order-csv-export-modal",string:b})},i=function(b,c,d){var e,f;return e={action:"wc_customer_order_csv_export_create_export",security:wc_customer_order_csv_export_admin.create_export_nonce,export_type:c||"orders",export_query:b,export_method:d||"download"},f=wp.template("wc-customer-order-csv-export-modal-body-export-started"),r({title:wc_customer_order_csv_export_admin.i18n.export_started,body:f({export_method:d}),action:wc_customer_order_csv_export_admin.is_batch_enabled?wc_customer_order_csv_export_admin.i18n.cancel:wc_customer_order_csv_export_admin.i18n.close,button_class:wc_customer_order_csv_export_admin.is_batch_enabled?"cancel-export":""}),a.post(ajaxurl,e).done(function(b){var c;if(a("#wc-backbone-modal-dialog").length)return!1===b.success?k({title:b.data.title,message:b.data.message}):(a("#wc-backbone-modal-dialog").addClass("wc-customer-order-csv-export-"+b.export_id).data("wc-customer-order-csv-export-id",b.export_id),wc_customer_order_csv_export_admin.is_batch_enabled?h(b.export_id):(c=!1,p[b.export_id]=setInterval(function(){if(!c)return c=!0,a.get(b.status_url).done(function(a){return"string"==typeof a?k():(c=!1,!1===a.success?(g(b.export_id),k(a.data)):"completed"===a.data.status?j(a.data):void 0)}).fail(function(a,b,c){return k()})},2e3)))}).fail(function(a,b,c){return k()})},o=function(b){var c,d,e;return e=wp.template("wc-customer-order-csv-export-modal-body-export-started"),r({title:wc_customer_order_csv_export_admin.i18n.export_resumed,body:e({export_method:"download"})}),c=a(".file_actions .resume[data-export-id="+b+"]").parents("tr"),d=c.find(".export_status mark"),d.removeClass("paused").addClass("processing"),c.find(".file_actions .resume").addClass("disabled").attr("href","").blur(),c.find(".file_actions .cancel").removeClass("cancel").addClass("delete"),h(b).then(function(a){return d.removeClass("processing").addClass(a),c.find(".file_actions .resume").removeClass("disabled").removeClass("resume").addClass("download")})},h=function(b){return window.onbeforeunload=function(){return wc_customer_order_csv_export_admin.i18n.confirm_export_cancel},a(document).on("wc_customer_order_csv_export_background_export_batch_progress_"+b,function(b,c){return a(".wc-customer-order-csv-export-progress").val(c.percentage)}),a(document).on("click","#btn-ok.cancel-export",function(a){if(confirm(wc_customer_order_csv_export_admin.i18n.confirm_export_cancel))return window.onbeforeunload=null,wc_customer_order_csv_export_background_export_batch_handler.cancelled=b}),wc_customer_order_csv_export_background_export_batch_handler.process_job(b).then(function(b){return window.onbeforeunload=null,a(".wc-customer-order-csv-export-progress").val(100),j(b.data)}).catch(function(b){return a(".wc-customer-order-csv-export-progress").hide(),k(b.data)})},j=function(a){var b;if("download"===a.method||"local"===a.method||"completed"===a.transfer_status)return b=wp.template("wc-customer-order-csv-export-modal-body-export-completed"),r({title:wc_customer_order_csv_export_admin.i18n.export_completed,body:b({export_method:a.method,download_url:a.download_url}),action:wc_customer_order_csv_export_admin.i18n.done}),"download"===a.method&&(window.location.href=a.download_url),g(a.export_id),a.status},k=function(a){var b,c,d;if(null==a&&(a=null),d=wc_customer_order_csv_export_admin.i18n.unexpected_error,b=wc_customer_order_csv_export_admin.i18n.unexpected_error_message,c=null,null!=a){if(null!=a.status)switch(c=a.status,a.status){case"not-found":d=wc_customer_order_csv_export_admin.i18n.export_not_found;break;case"failed":d=wc_customer_order_csv_export_admin.i18n.export_failed;break;case"completed":d="failed"===a.transfer_status?wc_customer_order_csv_export_admin.i18n.export_transfer_failed:wc_customer_order_csv_export_admin.i18n.export_completed}else null!=a.title&&(d=a.title);null!=a.message&&(b=a.message)}return r({title:d,body:'<p><span class="dashicons dashicons-warning"></span> '+b+"</p>",action:wc_customer_order_csv_export_admin.i18n.close}),c},g=function(b){return a.get(ajaxurl,{action:"wc_plugin_framework_customer_order_csv_export_dismiss_notice",messageid:"wc_customer_order_csv_export_finished_"+b})},wc_customer_order_csv_export_admin.settings_page===pagenow&&("export"===wc_customer_order_csv_export_admin.current_tab&&(l={dateFormat:"yy-mm-dd",numberOfMonths:1,showButtonPanel:!0,showOn:"button",buttonImage:wc_customer_order_csv_export_admin.calendar_icon_url,buttonImageOnly:!0},a("#start_date").datepicker(l),a("#end_date").datepicker(l),a("input[name=type]").change(function(){var b;return b=a(".show_if_orders").closest("tr").add(a("#subscription_orders").closest("table.form-table")).add(a("#subscription_orders").closest("table.form-table").prev("h2")),"customers"===a(this).val()?b.hide():b.show()}),a("#mainform").submit(function(a){var b,c;return a.preventDefault(),c=q(this),b=c.type,delete c.type,i(c,b,"download")})),"export_list"===wc_customer_order_csv_export_admin.current_tab&&(a(".file_actions").find(".delete").on("click",function(a){if(!confirm(wc_customer_order_csv_export_admin.i18n.confirm_export_delete))return a.preventDefault()}),a(".file_actions").find(".cancel").on("click",function(a){if(!confirm(wc_customer_order_csv_export_admin.i18n.confirm_export_cancel))return a.preventDefault()}),a(".file_actions").find(".transfer, .email").on("click",function(a){if(!confirm(wc_customer_order_csv_export_admin.i18n.confirm_export_transfer))return a.preventDefault()}),a(".file_actions").find(".resume").on("click",function(b){if(b.preventDefault(),!a(b.target).hasClass("disabled"))return o(a(b.target).data("export-id"))})),"settings"===wc_customer_order_csv_export_admin.current_tab&&(c={ftp:a(".js-auto-export-ftp-field:first").closest("table"),http_post:a(".js-auto-export-http-post-field:first").closest("table"),email:a(".js-auto-export-email-field:first").closest("table")},a(".js-auto-export-trigger").change(function(){var b,c;return c=a(this).val(),b=a(".js-auto-export-schedule-field").closest("tr"),"immediate"===c?b.hide():b.show()}).change(),a(".js-auto-export-method").change(function(){var b,d;return d=a(this).val(),b=a(this).closest("tr").nextUntil("h3"),"disabled"===d?b.hide():(b.show(),a(".js-auto-export-trigger").change()),"local"===d?a(this).next("span.description").show():a(this).next("span.description").hide(),a.each(c,function(a,b){var c;return c=a===d?"show":"hide",b[c]().prev()[c]()})}).change(),a(".js-auto-export-timepicker").timepicker({step:5}),a("select.js-auto-export-ftp-security").change(function(){var b,c,d;if(b=a(".js-auto-export-ftp-port"),c=Number(b.val(),10),d=a(this).val(),""===c||[21,22,990].indexOf(c)>-1)return"sftp"===d?b.val(22):"ftp_ssl"===d?b.val(990):b.val(21)}).change(),a(".js-auto-export-test-button").on("click",function(){return a("<input>").attr({type:"hidden",id:"wc_customer_order_csv_export_test_method",name:"wc_customer_order_csv_export_test_method",value:a(this).data("method")}).appendTo(".woocommerce form")})),"custom_formats"===wc_customer_order_csv_export_admin.current_tab&&(a(document.body).on("click.wp-toggle-checkboxes","thead .sv-check-column :checkbox, tfoot .sv-check-column :checkbox",function(b){var c,d,e;c=a(this).closest("table"),d=a(this).prop("checked"),e=b.shiftKey||a(this).data("wp-toggle"),c.children("tbody").filter(":visible").children().children(".check-column").find(":checkbox").prop("checked",function(){return!a(this).is(":hidden,:disabled")&&(e?!a(this).prop("checked"):!!d)}),c.children("thead, tfoot").filter(":visible").children().children(".check-column").find(":checkbox").prop("checked",function(){return!e&&!!d})}),a(".js-row-type").change(function(){var b,c,d,e;return e=a(".js-show-if-single-order-format").closest("tr"),b=a("select.js-field-key"),d=b.find('option[value="line_items"]'),c=b.find('option[value^="item_"]'),"order"===a(this).val()?(e.show(),d.prop("disabled",!1),c.prop("disabled",!0)):(e.hide(),d.prop("disabled",!0),c.prop("disabled",!1),a("#wc_customer_order_csv_export_orders_custom_format_items_format").val("pipe_delimited").change()),b.not('[name*="[__INDEX__]"]').removeClass("enhanced").select2("destroy"),a(document.body).trigger("wc-enhanced-select-init")}).change(),b=a(".wc-customer-order-csv-export-field-mapping"),e=function(c,d){var e,f,g;if(null==c&&(c={}),null==d&&(d=!1),f=b.find(".field-mapping-__INDEX__"),g=b.find("tbody tr").length-2,e=a(f.prop("outerHTML").replace(/__INDEX__/g,g)),e.find(".enhanced").removeClass("enhanced"),c.key&&(e.find(".js-field-key").val(c.key),"meta"===c.key?(e.find(".js-field-meta-key-label").show(),c.meta_key&&e.find(".js-field-meta-key").val(c.meta_key)):"static"===c.key&&(e.find(".js-field-static-value-label").show(),c.static_value&&e.find(".js-field-static-value").val(c.static_value))),c.name&&e.find(".js-field-name").val(c.name),f.before(e),b.find(".no-field-mappings").addClass("hide"),b.find("tfoot .js-remove-field-mapping").removeClass("hide"),d)return a(document.body).trigger("wc-enhanced-select-init")},n=function(c,d,e){var f;return null==d&&(d=400),null==e&&(e=null),e=e||function(){},f=function(){return b.find("tbody tr:visible").length<1&&(b.find(".no-field-mappings").removeClass("hide"),b.find(".js-remove-field-mapping").addClass("hide")),b.find('th.check-column input[type="checkbox"]').removeAttr("checked")},d?a.when(a(c).closest("tr.field-mapping").fadeOut(d,function(){var b;return b=a(this),setTimeout(function(){return b.remove()},1)})).then(function(){return f(),setTimeout(e,1)}):(a(c).closest("tr.field-mapping").remove(),f(),e())},m=function(){var c;return c=0,b.find("tr.field-mapping").each(function(b,d){if(!a(d).hasClass("field-mapping-__INDEX__"))return a(d).removeClass(function(a,b){var c,d;if(d=new RegExp("field-mapping-([0-9])*","g"),c=b.match(d))return c[0]}),a(d).addClass("field-mapping-"+c),a("input, select, textarea",d).each(function(a,b){var d;if(d=jQuery(b),d.attr("name"))return d.attr("name",d.attr("name").replace(/\[([^[]*)\]/,"["+c+"]"))}),c++})},f=function(c){return a(".wc-customer-order-csv-export-field-mapping").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),setTimeout(function(){var d;return c="string"==typeof c?JSON.parse(c):c,a(".js-include-all-meta").prop("checked",!0===c.include_all_meta),wc_customer_order_csv_export_admin.is_wc_version_gte_3_0?(c.delimiter&&a(".js-row-type").val(c.row_type).trigger("change"),c.row_type&&a(".js-row-type").length&&a(".js-row-type").val(c.row_type).trigger("change"),c.items_format&&a(".js-items-format").length&&a(".js-items-format").val(c.items_format).trigger("change")):(c.delimiter&&a(".js-delimiter").select2("val",c.delimiter,!0),c.row_type&&a(".js-row-type").length&&a(".js-row-type").select2("val",c.row_type,!0),c.items_format&&a(".js-items-format").length&&a(".js-items-format").select2("val",c.items_format,!0)),n(b.find("tbody tr.field-mapping:not(.field-mapping-__INDEX__)"),!1),d=a.map(c.columns,function(a,b){return"string"==typeof a&&(a={name:a}),a.key||(a.key=b),a}),s(d,e,this,function(){return m(),a(document.body).trigger("wc-enhanced-select-init"),a(".wc-customer-order-csv-export-field-mapping").unblock()})},1)},b.find(".js-add-field-mapping").click(function(a){return a.preventDefault(),e(null,!0)}),b.find(".js-remove-field-mapping").click(function(a){var c;return a.preventDefault(),c=b.find('tbody input[type="checkbox"]:checked'),n(c,null,m)}),b.find(".js-load-mapping").click(function(b){return b.preventDefault(),r({title:wc_customer_order_csv_export_admin.i18n.load_mapping,body:a("#tmpl-wc-customer-order-csv-export-modal-body-load-mapping").html(),action:wc_customer_order_csv_export_admin.i18n.load,button_class:"button-primary"})}),a(document.body).on("change","#load-mapping-source",function(b){var c;return c=a(b.target).val(),"snippet"===c?a("#load-mapping-snippet").show():a("#load-mapping-snippet").hide()}),a(document.body).on("wc_backbone_modal_response",function(a,b,c){var d;return d="snippet"===c.source?c.snippet?JSON.parse(c.snippet):{columns:{}}:wc_customer_order_csv_export_admin.export_formats[c.source],setTimeout(function(){return f(d)},1)}),b.find("tbody").sortable({items:"tr",cursor:"move",axis:"y",handle:"td.sort",scrollSensitivity:40,update:m}),b.on("change","select.js-field-key",function(b){var c,d,e,f,g;if(c=a(b.target),e=c.closest("tr").find(".js-field-name"),d=c.closest("td").find(".js-field-meta-key-label"),f=c.closest("td").find(".js-field-static-value-label"),"meta"===c.val()?d.removeClass("hide").find("input").focus():d.addClass("hide").find("input").val(""),"static"===c.val()?f.removeClass("hide").find("input").focus():f.addClass("hide").find("input").val(""),!e.val()||b.removed&&b.removed.id===e.val())return g="meta"===c.val()?"":c.val(),e.val(g)}),a("#mainform").submit(function(b){return a("tr.field-mapping-__INDEX__").remove()}))),"edit-shop_order"===pagenow&&(a('#posts-filter input[type="submit"].action').on("click",function(b){var c,d,e;if(c=a(b.target).prev("select").val(),"download_to_csv"===c||"export_to_csv_via_auto_export_method"===c)return b.preventDefault(),e="download_to_csv"===c?"download":"auto_export",d=a.map(a("#posts-filter").find('input[name="post[]"]:checked'),function(b){return Number(a(b).val(),10)}),i({ids:d},"orders",e)}),a(".order_actions .download_to_csv").on("click",function(b){var c;return b.preventDefault(),c=a(this).closest("tr").find('th input[name="post[]"]').val(),i({ids:c},"orders","download")})),"shop_order"===pagenow&&a("form#post").submit(function(b){var c,d,e;if(c=a(this).find('select[name="wc_order_action"]').val(),c&&["wc_customer_order_csv_export_download","wc_customer_order_csv_export_via_auto_export_method"].indexOf(c)!==-1)return b.preventDefault(),e="wc_customer_order_csv_export_download"===c?"download":"auto_export",d=[woocommerce_admin_meta_boxes.post_id],i({ids:d},"orders",e)}),"users"===pagenow&&a(".bulkactions #doaction").on("click",function(b){var c,d,e;if(c=a(b.target).prev("select").val(),"download_to_csv"===c||"export_to_csv_via_auto_export_method"===c)return b.preventDefault(),e="download_to_csv"===c?"download":"auto_export",d=a.map(a(".wp-list-table.users").find('input[name="users[]"]:checked'),function(b){return Number(a(b).val(),10)}),i({ids:d},"customers",e)}),a("body").on("wc_backbone_modal_before_remove",function(b){var c;if(c=a("#wc-backbone-modal-dialog").data("wc-customer-order-csv-export-id"),c&&p[c])return clearInterval(p[c])})})}).call(this);